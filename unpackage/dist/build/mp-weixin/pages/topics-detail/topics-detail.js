(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/topics-detail/topics-detail"],{"061c":function(t,e,i){"use strict";i.r(e);var n=i("969f"),o=i.n(n);for(var r in n)"default"!==r&&function(t){i.d(e,t,(function(){return n[t]}))}(r);e["default"]=o.a},"2a6f":function(t,e,i){"use strict";i.r(e);var n=i("99f7"),o=i("061c");for(var r in o)"default"!==r&&function(t){i.d(e,t,(function(){return o[t]}))}(r);i("7c46");var a,c=i("f0c5"),l=Object(c["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],a);e["default"]=l.exports},"42ef":function(t,e,i){},"7c46":function(t,e,i){"use strict";var n=i("42ef"),o=i.n(n);o.a},"969f":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i("5ec6"),o=i("2f62");function r(t){return u(t)||l(t)||c(t)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(t,e){if(t){if("string"===typeof t)return s(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}function l(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function u(t){if(Array.isArray(t))return s(t)}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function d(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function f(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?d(Object(i),!0).forEach((function(e){h(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):d(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function h(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var p=function(){Promise.all([i.e("common/vendor"),i.e("components/article-detail/article-detail")]).then(function(){return resolve(i("0251"))}.bind(null,i)).catch(i.oe)},g={components:{ArticleDetail:p},data:function(){return{articles:[],load:{},tabIndex:0,articleAreaHeight:0,topicDetail:{},pageSize:5,noDataShow:!1,requestTime:0}},filters:{formatTime:function(t){return(0,n.convertDate)(t)}},computed:f({},(0,o.mapState)(["userid","topicDetailCache"])),watch:{articles:function(t){this.articles=t}},onLoad:function(t){this.topicDetail=this.topicDetailCache,this.getArticleByTopicId(t.params)},methods:{getTopicDetailById:function(e){var i=this;t.showLoading(),t.request({url:"http://localhost:8000/forum/get_topic",data:{id:e},success:function(n){var o=n.data,r=o.code,a=o.data;200===r?(t.hideLoading(),i.topicDetail=a,console.log(i.topicDetail),i.heightHandler(),i.getArticleByTopicId(e)):(t.hideLoading(),t.showToast({title:"获取数据失败, 请稍后再试",icon:"none"}))},fail:function(e){t.hideLoading(),t.showToast({title:"获取数据失败, 请稍后再试",icon:"none"})}})},getArticleByTopicId:function(e){var i=this;this.load&&"{}"!==JSON.stringify(this.load)||(this.load={page:1,loading:"loading"}),t.request({method:"GET",url:this.$api.address+"forum/get_article/".concat(this.userid,"/").concat(e,"/").concat(this.load.page,"/").concat(this.pageSize),success:function(e){var n=e.data,o=n.data,a=n.code;if(200===a){if(0===i.requestTime&&0!==o.length&&(i.heightHandler(),i.bottomHeightHandler()),0===o.length){if(0===i.requestTime)return void(i.noDataShow=!0);var c={loading:"noMore"};return c.page=i.load.page,i.load=c,void i.$forceUpdate()}i.requestTime++;var l=i.articles;l.push.apply(l,r(o)),i.articles=l,i.$forceUpdate()}else if(500===a){var u={loading:"noMore"};u.page=i.load.page,i.load=u,i.$forceUpdate(),t.showToast({title:"数据请求失败, 请稍后再试",icon:"none"})}},fail:function(e){var n={loading:"noMore"};n.page=i.load.page,i.load=n,i.$forceUpdate(),t.showToast({title:"数据请求失败, 请稍后再试",icon:"none"})}})},change:function(t){this.tabIndex=t.detail.current},showHeight:function(t){var e=t.tabIndex,i=t.height;this.articleDetailHeightMap[e]=i,this.tabIndex=this.tabIndex},heightHandler:function(){var e=this,i=t.createSelectorQuery().in(this);i.select(".topic-area").boundingClientRect((function(i){var n=t.getSystemInfoSync();e.articleAreaHeight=e.articleAreaHeight+n.windowHeight-i.height})).exec()},bottomHeightHandler:function(){var e=this,i=t.createSelectorQuery().in(this);i.select(".article-action").boundingClientRect((function(t){console.log(t),e.articleAreaHeight=e.articleAreaHeight-t.height})).exec()},writeArticleForTopic:function(){var e={id:this.topicDetail._id,type:this.topicDetail.classify,title:this.topicDetail.title};this.$store.dispatch("set_answerTopic_cache",e),t.navigateTo({url:"/pages/article-imple/article-imple?params=answer"})},loadmore:function(t){"noMore"!==this.load.loading&&t.detail.current===this.articles.length&&(this.load.page++,this.getArticleByTopicId(this.topicDetail._id))}}};e.default=g}).call(this,i("543d")["default"])},"99f7":function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return r})),i.d(e,"a",(function(){return n}));var n={articleDetail:function(){return Promise.all([i.e("common/vendor"),i.e("components/article-detail/article-detail")]).then(i.bind(null,"0251"))},uniLoadMore:function(){return i.e("components/uni-load-more/uni-load-more").then(i.bind(null,"a730"))}},o=function(){var t=this,e=t.$createElement,i=(t._self._c,t._f("formatTime")(t.topicDetail.create_time));t.$mp.data=Object.assign({},{$root:{f0:i}})},r=[]},cf1c:function(t,e,i){"use strict";(function(t){i("31d6");n(i("66fd"));var e=n(i("2a6f"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])}},[["cf1c","common/runtime","common/vendor"]]]);